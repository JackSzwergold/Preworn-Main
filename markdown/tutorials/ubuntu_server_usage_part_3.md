# Using an Ubuntu Linux Server

Written by [Jack Szwergold][1] on March 30, 2014

## Part 3: Monitoring & Securing Your Ubuntu Server

In part 3 of my tutorial I will explain how to setup useful monitoring & security tools. You should never be in a situation where you cannot be able to review & assess server health. Being able to monitor & secure your server is the key to running a safe & stable server environment. 

### Install the ‘iptables’ firewall.

First we’re going to install `iptables`, which is an excellent & widely used software-based firewall.  We’ll also be installing `iptables-persistent` which is a simply companion tool that allows `iptables` to be reloaded & active if/when a server reboots:

    sudo aptitude install iptables iptables-persistent

Next, we’re going to create a very basic set of `iptables` rules to start off with. Below is a simple `iptables` rule set export of a basic setup I like to use:

    # Generated by iptables-save v1.4.12 on Sun Apr  6 11:50:24 2014
    *nat
    :PREROUTING ACCEPT [0:0]
    :INPUT ACCEPT [0:0]
    :OUTPUT ACCEPT [3:198]
    :POSTROUTING ACCEPT [3:198]
    COMMIT
    # Completed on Sun Apr  6 11:50:24 2014
    # Generated by iptables-save v1.4.12 on Sun Apr  6 11:50:24 2014
    *mangle
    :PREROUTING ACCEPT [22:1475]
    :INPUT ACCEPT [22:1475]
    :FORWARD ACCEPT [0:0]
    :OUTPUT ACCEPT [21:3342]
    :POSTROUTING ACCEPT [21:3342]
    COMMIT
    # Completed on Sun Apr  6 11:50:24 2014
    # Generated by iptables-save v1.4.12 on Sun Apr  6 11:50:24 2014
    *filter
    :INPUT ACCEPT [0:0]
    :FORWARD ACCEPT [0:0]
    :OUTPUT ACCEPT [21:3342]
    :SSH_CHECK - [0:0]
    -A INPUT -p tcp -m tcp --dport 22 -m state --state NEW -j SSH_CHECK
    -A INPUT -i lo -j ACCEPT
    -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
    -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT
    -A INPUT -p icmp -m icmp --icmp-type any -j ACCEPT
    -A INPUT -p esp -j ACCEPT
    -A INPUT -p ah -j ACCEPT
    -A INPUT -d 224.0.0.251/32 -p udp -m udp --dport 5353 -j ACCEPT
    -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
    -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
    -A INPUT -j REJECT --reject-with icmp-host-prohibited
    -A FORWARD -j TOR
    -A SSH_CHECK -m recent --set --name SSH --rsource
    -A SSH_CHECK -m recent --update --seconds 60 --hitcount 4 --name SSH --rsource -j DROP
    COMMIT
    # Completed on Sun Apr  6 11:50:24 2014

It seems like there is a lot of stuff happening here—and there is—but it’s pretty simple: The stuff in `*nat` & `*mangle` are boilerplate defaults from an iptables rule set export. The stuff in `*filter` is where the basic cool stuff happens. The important lines in there includes the `SSH_CHECK` which protects against someone “wardialing” your SSH connection. It’s called as part of the `INPUT` chain at the top of the list, but it’s behavior is defined near the bottom of the list. The next set of rules 


    sudo iptables-restore < iptables.conf

    sudo cp ~/iptables.conf /etc/iptables/rules.v4

[1]: http://www.preworn.com/ "Preworn • Jack Szwergold’s Online Portfolio"